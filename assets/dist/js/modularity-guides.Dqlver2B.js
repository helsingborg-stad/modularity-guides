var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});(()=>{const SELECTOR_TODOS_WRAPPER=".js-modularity-guide-todos",SELECTOR_FORM=".js-modularity-guide-todos__form",SELECTOR_MODAL_CLOSE_BUTTON=".js-modularity-guide-todos__modal .c-modal__close",SELECTOR_FORM_NOTICE=".js-modularity-guide-todos__notice",SELECTOR_INPUT_EMAIL='input[name="email"]',SELECTOR_API_URL="data-js-modularity-guide-post-url",NOTICE_LEVEL_CLASSNAMES={info:"c-notice--info",success:"c-notice--success",danger:"c-notice--danger",warning:"c-notice--warning"};function getCheckList(todoTable){const keys=[];return todoTable?.querySelectorAll("[data-mod-guide-toggle-key-content]")?.forEach(checkbox=>{checkbox.checkVisibility()&&keys.push(checkbox.getAttribute("data-mod-guide-toggle-key-content")??"")}),keys}__name(getCheckList,"getCheckList");function handleSubmit(e){e.preventDefault();const currentForm=e.target,currentSection=currentForm?.closest(SELECTOR_TODOS_WRAPPER),email=currentForm?.querySelector(SELECTOR_INPUT_EMAIL)?.value,apiUrl=currentSection?.closest(`[${SELECTOR_API_URL}]`)?.getAttribute(SELECTOR_API_URL);console.log("API URL",apiUrl);function setNotice(text,level="info",icon=""){const noticeElement=currentSection?.querySelector(SELECTOR_FORM_NOTICE),noticeIconElement=noticeElement?.querySelectorAll("c-icon"),noticeClassList=noticeElement?.classList,noticeLevelClassName=NOTICE_LEVEL_CLASSNAMES[level];if(typeof text=="boolean"&&text===!1){noticeClassList?.contains("u-display--none")||noticeClassList?.add("u-display--none");return}if(noticeClassList&&noticeLevelClassName&&!noticeClassList?.contains(noticeLevelClassName)&&([...noticeClassList].filter(className=>Object.values(NOTICE_LEVEL_CLASSNAMES).includes(className)).forEach(className=>{noticeClassList?.remove(className)}),noticeClassList?.add(noticeLevelClassName)),typeof text=="string"&&text.length>0){const spanElements=Array.from(noticeElement?.querySelectorAll("span")??[]),textSpan=spanElements.length===2?spanElements[1]:spanElements[0];textSpan.innerHTML=text,icon.length>0&&noticeIconElement&&noticeIconElement.forEach(x=>{x.innerHTML=icon}),noticeClassList?.remove("u-display--none")}}if(__name(setNotice,"setNotice"),setNotice(!1),currentSection&&email&&apiUrl){currentSection?.classList.toggle("is-loading");const data={action:"email_todo",checklist:getCheckList(currentSection),email};fetch(apiUrl,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(data)}).then(response=>{currentSection?.classList.toggle("is-loading"),response.json().then(data2=>{data2?(currentSection?.classList.toggle("is-loading"),setNotice(guides.email_sent,"success","report"),setTimeout(()=>{setNotice(!1),currentSection?.querySelector(SELECTOR_MODAL_CLOSE_BUTTON)?.click()},2e3)):setNotice(guides.email_failed,"danger","report")})}).catch(error=>{console.log(JSON.stringify(error))})}}__name(handleSubmit,"handleSubmit");function subscribeForm(todoSection){todoSection?.querySelector(SELECTOR_FORM)?.addEventListener("submit",handleSubmit)}__name(subscribeForm,"subscribeForm");function init2(){const todoSections=document.querySelectorAll(SELECTOR_TODOS_WRAPPER);todoSections?.length>0&&todoSections.forEach(todoSection=>{subscribeForm(todoSection)})}__name(init2,"init"),window.addEventListener("DOMContentLoaded",init2)})();($=>{function Checkboxes(){this.handleEvents(),this.contentToggleEngine()}return __name(Checkboxes,"Checkboxes"),Checkboxes.prototype.handleEvents=function(){$('input[type="checkbox"][data-mod-guide-relation]').on("change",function(){let relations=$(this).data("mod-guide-relation");relations=relations.split(","),$.each(relations,(_,item)=>{const $cb=$('input[type="checkbox"][data-mod-guide-toggle-key="'+item+'"]');$cb.prop("checked",!$cb.prop("checked")).trigger("change")})}),$("[data-mod-guide-toggle-key]").on("change",(function(){this.contentToggleEngine()}).bind(this))},Checkboxes.prototype.contentToggleEngine=()=>{const checked=[];$("[data-mod-guide-toggle-key]").each((_,element)=>{$(element).prop("checked")===!0&&checked.push($(element).attr("data-mod-guide-toggle-key"))}),$("[data-mod-guide-todo-widget]").each((_,element)=>$(element).hide()),$("[data-mod-guide-toggle-key-content]").each((_,element)=>{let shouldShow=!1,conditions=$(element).attr("data-mod-guide-toggle-key-content");if(conditions=conditions.split(","),$.each(conditions,(_2,item)=>{const and=item.match(/(^|\+)([^+-]+)/g),andPattern=new RegExp("\\b("+and?.join("|").replace("+","")+")\\b","ig"),andMatches=checked.join(",").match(andPattern),andIsMatching=andMatches!==null&&andMatches.length===and?.length,andnot=item.match(/-([^+-]+)/g);let andnotIsMatching=!0;if(andnot!==null){const andnotPattern=new RegExp("\\b("+andnot.join("|").replace("-","")+")\\b","ig"),andnotMatches=checked.join(",").match(andnotPattern);andnotIsMatching=!(andnotMatches!==null&&andnotMatches.length>0)}andIsMatching&&andnotIsMatching&&(shouldShow=!0)}),shouldShow){$(element).show(),$(element).closest("tr").show(),$(element).closest("[data-mod-guide-todo-widget]").show();return}$(element).hide(),$(element).closest("tr").hide()})},new Checkboxes})(jQuery);const SELECTOR_MODULARITY_GUIDE=".js-modularity-guide",SELECTOR_SECTION=".js-modularity-guide__section",SELECTOR_NEXT=".js-modularity-guide__next",SELECTOR_PREV=".js-modularity-guide__prev",SELECTOR_ACCORDION_TOGGLE="[js-expand-button]",ATTRIBUTE_STEP="data-guide-step";function handlePrevNextClick(e){e.preventDefault();const prevNextButtonElement=e.target,isNext=prevNextButtonElement?.classList.contains(SELECTOR_NEXT.substring(1)),currentGuide=prevNextButtonElement?.closest(SELECTOR_MODULARITY_GUIDE),currentSection=prevNextButtonElement?.closest(SELECTOR_SECTION),currentStep=parseInt(currentSection?.getAttribute(ATTRIBUTE_STEP)??"-1");if(currentStep>0){const targetStep=isNext?currentStep+1:currentStep-1,targetToggle=currentGuide?.querySelector(`[${ATTRIBUTE_STEP}="${targetStep}"]`)?.querySelector(SELECTOR_ACCORDION_TOGGLE);targetToggle&&targetToggle.click()}}__name(handlePrevNextClick,"handlePrevNextClick");function subscribePrevNextButtons(wrapperElement){const buttons=[...wrapperElement.querySelectorAll(`${SELECTOR_SECTION} ${SELECTOR_NEXT}`),...wrapperElement.querySelectorAll(`${SELECTOR_SECTION} ${SELECTOR_PREV}`)];buttons.length>0&&buttons.forEach(buttonElement=>{buttonElement.addEventListener("click",handlePrevNextClick)})}__name(subscribePrevNextButtons,"subscribePrevNextButtons");function init(){const guideModules=document.querySelectorAll(SELECTOR_MODULARITY_GUIDE);guideModules&&guideModules.length>0&&guideModules.forEach(subscribePrevNextButtons)}__name(init,"init");window.addEventListener("DOMContentLoaded",init);
//# sourceMappingURL=modularity-guides.Dqlver2B.js.map
